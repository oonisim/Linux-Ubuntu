#--------------------------------------------------------------------------------
# [Author]  Masayuki Onishi
# [History] Ver 1.0 10 JUL 2016 initial for Ubuntu 14.04
#--------------------------------------------------------------------------------
# [Function]
#     Template for Ubuntu kickstart configuration.
#     Preseeding is used Ubuntu/OS related configurations. Kick start is used to
#     cover what preseeding does not, and non Ubuntu/OS generic related stuff,
#     such as invoking site specific post installation configurations, etc.
#--------------------------------------------------------------------------------

#Generated by Kickstart Configurator
#platform=x86

#--------------------------------------------------------------------------------
# Use text mode auto install, NOT GUI interactive.
#--------------------------------------------------------------------------------
text

#--------------------------------------------------------------------------------
# Installation options being asked before preseed is loaded.
#--------------------------------------------------------------------------------
#Install OS instead of upgrade
install
#Use CDROM installation media
cdrom
#Reboot after installation
reboot
#System language
lang en_AU
#Language modules to install
langsupport en_AU
#System keyboard
keyboard us
#System mouse
mouse

#--------------------------------------------------------------------------------
#System timezone
#--------------------------------------------------------------------------------
#timezone Australia/Sydney

#--------------------------------------------------------------------------------
# Accounts
#--------------------------------------------------------------------------------
#Root password
#rootpw --disabled
#Initial user
#user wynadmin --fullname "wynadmin" --iscrypted --password $1$rSy6Q8hM$RW0fkvABI2lrcROMW1th70
#System authorization infomation
#auth  --useshadow  --enablemd5

#--------------------------------------------------------------------------------
# Disk partitions. Without these options, guided partition will be asked.
#--------------------------------------------------------------------------------
#System bootloader configuration
bootloader --location=mbr 
#Clear the Master Boot Record
zerombr yes
#Partition clearing information
clearpart --all
#Disk partitioning information.
#part /boot --ondisk=sda --fstype ext4 --size 512
#part /     --ondisk=sda --fstype btrfs --size 34840 --grow
#part /data --ondisk=sdb --fstype xfs --size 35840 --grow


#--------------------------------------------------------------------------------
# Network information.
# Unable to configure static network in preseed, hence placed here.
# (Switch from DHCP to Static was tried but ifdown failed when switching to static)
#--------------------------------------------------------------------------------
#network --bootproto=dhcp --device=eth0 --hostname=kickseed
network --bootproto=static --device=${INTERFACE} --hostname=${HOSTNAME}.${DNS_DOMAIN} --ip=${ADDRESS} --netmask=${NETMASK} --gateway=${GATEWAY} --nameserver=${DNS_HOST}

#Firewall configuration
#firewall --disabled
#X Window System configuration information
#xconfig --depth=32 --resolution=1280x1024 --defaultdesktop=GNOME

#--------------------------------------------------------------------------------
# Packages
#--------------------------------------------------------------------------------
#%packages
#@ ubuntu-server
#openssh-server
#telnet
#build-essential
#linux-headers-generic
#ubuntu-desktop
#gnome

#--------------------------------------------------------------------------------
# Post installation
#--------------------------------------------------------------------------------
%post --log=/var/log/ks.post.log
# Post installation script
export http_proxy="http://${PROXY_HOST}:${PROXY_PORT}"
export https_proxy="http://${PROXY_HOST}:${PROXY_PORT}"
export no_proxy="${NO_PROXY_HOSTS}"',localhost,127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,$(hostname)'
wget -O /var/post_install.sh http://${HTTPD_HOST}/cgi-bin/${SCRIPT_PATH}/post_install.sh
bash /var/post_install.sh

# END